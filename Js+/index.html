<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JS高级 | Ronan&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/avatar.jpg">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.7b36eabc.css" as="style"><link rel="preload" href="/assets/js/app.5ab2ec69.js" as="script"><link rel="preload" href="/assets/js/2.eeb24f79.js" as="script"><link rel="preload" href="/assets/js/8.8df23d51.js" as="script"><link rel="prefetch" href="/assets/js/10.d0415309.js"><link rel="prefetch" href="/assets/js/11.11f96ddc.js"><link rel="prefetch" href="/assets/js/12.17cdedb4.js"><link rel="prefetch" href="/assets/js/13.b53a64a6.js"><link rel="prefetch" href="/assets/js/14.6127168f.js"><link rel="prefetch" href="/assets/js/15.c6fec423.js"><link rel="prefetch" href="/assets/js/16.551a14fc.js"><link rel="prefetch" href="/assets/js/17.3ad529cc.js"><link rel="prefetch" href="/assets/js/18.9da1d026.js"><link rel="prefetch" href="/assets/js/19.0ff8f3e6.js"><link rel="prefetch" href="/assets/js/3.1801cb39.js"><link rel="prefetch" href="/assets/js/4.30c96a68.js"><link rel="prefetch" href="/assets/js/5.f0e2ef51.js"><link rel="prefetch" href="/assets/js/6.e86df8f9.js"><link rel="prefetch" href="/assets/js/7.e76e2440.js"><link rel="prefetch" href="/assets/js/9.8c479be0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7b36eabc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/avatar.jpg" alt="Ronan's Blog" class="logo"> <span class="site-name can-hide">Ronan's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/Css/" class="nav-link">
  Css
</a></div><div class="nav-item"><a href="/Js/" class="nav-link">
  Js
</a></div><div class="nav-item"><a href="/Js+/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Js高级
</a></div><div class="nav-item"><a href="/Ts/" class="nav-link">
  Ts
</a></div><div class="nav-item"><a href="/Vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/React/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/Network/" class="nav-link">
  Network
</a></div><div class="nav-item"><a href="/Webpack/" class="nav-link">
  Webpack
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Others/Git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/Others/Nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/Others/Algorithm/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/Others/粤语/" class="nav-link">
  粤语
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/Css/" class="nav-link">
  Css
</a></div><div class="nav-item"><a href="/Js/" class="nav-link">
  Js
</a></div><div class="nav-item"><a href="/Js+/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Js高级
</a></div><div class="nav-item"><a href="/Ts/" class="nav-link">
  Ts
</a></div><div class="nav-item"><a href="/Vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/React/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/Network/" class="nav-link">
  Network
</a></div><div class="nav-item"><a href="/Webpack/" class="nav-link">
  Webpack
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Others/Git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/Others/Nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/Others/Algorithm/" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/Others/粤语/" class="nav-link">
  粤语
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JS高级</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Js+/#js高级" class="sidebar-link">JS高级</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Js+/#浏览器引擎和js运行原理" class="sidebar-link">浏览器引擎和JS运行原理</a></li><li class="sidebar-sub-header"><a href="/Js+/#概览" class="sidebar-link">概览</a></li><li class="sidebar-sub-header"><a href="/Js+/#浏览器内核-渲染引擎和js引擎" class="sidebar-link">浏览器内核(渲染引擎和JS引擎)</a></li><li class="sidebar-sub-header"><a href="/Js+/#浏览器渲染过程" class="sidebar-link">浏览器渲染过程</a></li><li class="sidebar-sub-header"><a href="/Js+/#v8引擎架构" class="sidebar-link">V8引擎架构</a></li><li class="sidebar-sub-header"><a href="/Js+/#v8引擎解析图" class="sidebar-link">V8引擎解析图</a></li><li class="sidebar-sub-header"><a href="/Js+/#js代码执行原理" class="sidebar-link">JS代码执行原理</a></li><li class="sidebar-sub-header"><a href="/Js+/#js执行函数原理" class="sidebar-link">JS执行函数原理</a></li><li class="sidebar-sub-header"><a href="/Js+/#js内存管理" class="sidebar-link">JS内存管理</a></li><li class="sidebar-sub-header"><a href="/Js+/#闭包" class="sidebar-link">闭包</a></li><li class="sidebar-sub-header"><a href="/Js+/#闭包内存泄漏" class="sidebar-link">闭包内存泄漏</a></li></ul></li><li><a href="/Js+/#js函数" class="sidebar-link">JS函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Js+/#this指向" class="sidebar-link">this指向</a></li><li class="sidebar-sub-header"><a href="/Js+/#四种绑定规则" class="sidebar-link">四种绑定规则</a></li><li class="sidebar-sub-header"><a href="/Js+/#绑定优先级" class="sidebar-link">绑定优先级</a></li><li class="sidebar-sub-header"><a href="/Js+/#特殊绑定规则" class="sidebar-link">特殊绑定规则</a></li><li class="sidebar-sub-header"><a href="/Js+/#手写call" class="sidebar-link">手写call</a></li><li class="sidebar-sub-header"><a href="/Js+/#手写apply" class="sidebar-link">手写apply</a></li><li class="sidebar-sub-header"><a href="/Js+/#手写bind" class="sidebar-link">手写bind</a></li><li class="sidebar-sub-header"><a href="/Js+/#函数柯里化" class="sidebar-link">函数柯里化</a></li></ul></li><li><a href="/Js+/#js面向对象" class="sidebar-link">JS面向对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Js+/#对象属性描述符" class="sidebar-link">对象属性描述符</a></li><li class="sidebar-sub-header"><a href="/Js+/#对象方法补充" class="sidebar-link">对象方法补充</a></li><li class="sidebar-sub-header"><a href="/Js+/#创建对象的方法" class="sidebar-link">创建对象的方法</a></li><li class="sidebar-sub-header"><a href="/Js+/#new操作符的作用" class="sidebar-link">new操作符的作用</a></li><li class="sidebar-sub-header"><a href="/Js+/#对象原型-proto-和函数原型prototype" class="sidebar-link">对象原型 _ proto _和函数原型prototype</a></li><li class="sidebar-sub-header"><a href="/Js+/#继承" class="sidebar-link">继承</a></li></ul></li><li><a href="/Js+/#es6" class="sidebar-link">ES6</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Js+/#class类" class="sidebar-link">class类</a></li><li class="sidebar-sub-header"><a href="/Js+/#let和const" class="sidebar-link">let和const</a></li><li class="sidebar-sub-header"><a href="/Js+/#symbol" class="sidebar-link">Symbol</a></li><li class="sidebar-sub-header"><a href="/Js+/#weakset" class="sidebar-link">WeakSet</a></li><li class="sidebar-sub-header"><a href="/Js+/#weakmap" class="sidebar-link">WeakMap</a></li></ul></li><li><a href="/Js+/#es7" class="sidebar-link">ES7</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Js+/#数组includes" class="sidebar-link">数组includes</a></li><li class="sidebar-sub-header"><a href="/Js+/#指数运算符" class="sidebar-link">指数运算符</a></li></ul></li><li><a href="/Js+/#es8" class="sidebar-link">ES8</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Js+/#object-values" class="sidebar-link">Object.values</a></li><li class="sidebar-sub-header"><a href="/Js+/#object-entries" class="sidebar-link">Object.entries</a></li><li class="sidebar-sub-header"><a href="/Js+/#string-padding" class="sidebar-link">String.padding</a></li><li class="sidebar-sub-header"><a href="/Js+/#尾逗号" class="sidebar-link">尾逗号</a></li><li class="sidebar-sub-header"><a href="/Js+/#object-descriptors" class="sidebar-link">Object.Descriptors</a></li></ul></li><li><a href="/Js+/#es9" class="sidebar-link">ES9</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Js+/#async和await" class="sidebar-link">Async和Await</a></li><li class="sidebar-sub-header"><a href="/Js+/#对象展开符" class="sidebar-link">对象展开符</a></li><li class="sidebar-sub-header"><a href="/Js+/#promise-finally" class="sidebar-link">Promise finally</a></li></ul></li><li><a href="/Js+/#es10" class="sidebar-link">ES10</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Js+/#数组flat" class="sidebar-link">数组flat</a></li><li class="sidebar-sub-header"><a href="/Js+/#数组flatmap" class="sidebar-link">数组flatMap</a></li><li class="sidebar-sub-header"><a href="/Js+/#object-fromentries" class="sidebar-link">Object.fromEntries</a></li><li class="sidebar-sub-header"><a href="/Js+/#trimstart和trimend" class="sidebar-link">trimStart和trimEnd</a></li><li class="sidebar-sub-header"><a href="/Js+/#symbol-description" class="sidebar-link">Symbol description</a></li><li class="sidebar-sub-header"><a href="/Js+/#optional-catch-binding" class="sidebar-link">Optional catch binding</a></li></ul></li><li><a href="/Js+/#es11" class="sidebar-link">ES11</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Js+/#bigint" class="sidebar-link">BigInt</a></li><li class="sidebar-sub-header"><a href="/Js+/#空值合并操作符" class="sidebar-link">空值合并操作符</a></li><li class="sidebar-sub-header"><a href="/Js+/#可选链" class="sidebar-link">可选链</a></li><li class="sidebar-sub-header"><a href="/Js+/#global-this" class="sidebar-link">Global This</a></li><li class="sidebar-sub-header"><a href="/Js+/#for-in标准化" class="sidebar-link">for..in标准化</a></li><li class="sidebar-sub-header"><a href="/Js+/#dynamic-import" class="sidebar-link">Dynamic Import</a></li><li class="sidebar-sub-header"><a href="/Js+/#promise-allsettled" class="sidebar-link">Promise.allSettled</a></li><li class="sidebar-sub-header"><a href="/Js+/#import-meta" class="sidebar-link">import meta</a></li></ul></li><li><a href="/Js+/#es12" class="sidebar-link">ES12</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Js+/#finalizationregistry" class="sidebar-link">FinalizationRegistry</a></li><li class="sidebar-sub-header"><a href="/Js+/#weakref" class="sidebar-link">WeakRef</a></li><li class="sidebar-sub-header"><a href="/Js+/#逻辑赋值符" class="sidebar-link">逻辑赋值符</a></li><li class="sidebar-sub-header"><a href="/Js+/#数字分隔符" class="sidebar-link">数字分隔符</a></li><li class="sidebar-sub-header"><a href="/Js+/#string-replaceall" class="sidebar-link">String.replaceAll</a></li><li class="sidebar-sub-header"><a href="/Js+/#proxy类" class="sidebar-link">Proxy类</a></li><li class="sidebar-sub-header"><a href="/Js+/#reflect对象" class="sidebar-link">Reflect对象</a></li></ul></li><li><a href="/Js+/#vue响应式原理" class="sidebar-link">Vue响应式原理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Js+/#模块化" class="sidebar-link">模块化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Js+/#cookie" class="sidebar-link">cookie</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="js高级"><a href="#js高级" class="header-anchor">#</a> JS高级</h2> <h3 id="浏览器引擎和js运行原理"><a href="#浏览器引擎和js运行原理" class="header-anchor">#</a> 浏览器引擎和JS运行原理</h3> <h3 id="概览"><a href="#概览" class="header-anchor">#</a> 概览</h3> <p><img src="https://gitee.com/coderPjx/images/raw/master/images/Snipaste_2021-10-23_16-43-28.jpg" alt=""></p> <h3 id="浏览器内核-渲染引擎和js引擎"><a href="#浏览器内核-渲染引擎和js引擎" class="header-anchor">#</a> 浏览器内核(渲染引擎和JS引擎)</h3> <p>常说的浏览器内核指的是<strong>排版引擎或渲染引擎</strong></p> <p>实际上，浏览器内核可以分为两个部分：<strong>渲染引擎 + JS引擎</strong></p> <p>渲染引擎：负责HTML解析、布局、渲染等</p> <p>JS引擎：解析、执行jS代码</p> <p>主流<strong>渲染引擎</strong> 分类</p> <ul><li>Gecko	早期被Netscape和Mozilla Firefox浏览器浏览器使用</li> <li>Trident    微软开发，被IE4~IE11浏览器使用，但是***Edge浏览器已经转向Blink***</li> <li>Webkit    苹果基于KHTML开发、开源的，用于Safari，<em><strong>Google Chrome之前也在使用</strong></em></li> <li>Blink    是***Webkit的一个分支***，Google开发，目前应用于Google Chrome、Edge、Opera等</li></ul> <table><thead><tr><th style="text-align:center;">浏览器</th> <th style="text-align:center;">旧渲染引擎</th> <th style="text-align:center;">新渲染引擎</th></tr></thead> <tbody><tr><td style="text-align:center;">Chrome</td> <td style="text-align:center;">Webkit</td> <td style="text-align:center;">Blink</td></tr> <tr><td style="text-align:center;">Firefox</td> <td style="text-align:center;"></td> <td style="text-align:center;">Gecko</td></tr> <tr><td style="text-align:center;">IE</td> <td style="text-align:center;">Trident</td> <td style="text-align:center;">Edge：Blink</td></tr> <tr><td style="text-align:center;">Safari</td> <td style="text-align:center;"></td> <td style="text-align:center;">Webkit</td></tr> <tr><td style="text-align:center;">Opera</td> <td style="text-align:center;">自研Presto、Webkit</td> <td style="text-align:center;">Blink</td></tr></tbody></table> <p>主流<strong>JS引擎</strong> 分类</p> <table><thead><tr><th style="text-align:center;">浏览器</th> <th style="text-align:center;">JS引擎</th></tr></thead> <tbody><tr><td style="text-align:center;">Chrome</td> <td style="text-align:center;">V8</td></tr> <tr><td style="text-align:center;">Firefox</td> <td style="text-align:center;">SpiderMonkey（1.0-3.0）/ TraceMonkey（3.5-3.6）/ JaegerMonkey（4.0-）/ Rhino</td></tr> <tr><td style="text-align:center;">Opera</td> <td style="text-align:center;">Linear A（4.0-6.1）/ Linear B（7.0-9.2）/ Futhark（9.5-10.2）/ Carakan（10.5-）</td></tr> <tr><td style="text-align:center;">IE -&gt; Edge</td> <td style="text-align:center;">JScript（IE3.0-IE8.0 / Chakra（IE9+之后）</td></tr> <tr><td style="text-align:center;">Safari</td> <td style="text-align:center;">JavaScriptCore(1.0-3.1) / SquirrelFish (4.0-)</td></tr></tbody></table> <h3 id="浏览器渲染过程"><a href="#浏览器渲染过程" class="header-anchor">#</a> 浏览器渲染过程</h3> <ol><li>解析html和css</li> <li>构建DOM树和样式规则</li> <li>DOM树和样式规则 --&gt; 合并成渲染树 Rener Tree</li> <li>布局 Layout</li> <li>绘制 Painting</li> <li>展示</li></ol> <p><img src="https://gitee.com/coderPjx/images/raw/master/images/Snipaste_2021-10-23_17-22-41.jpg" alt=""></p> <p>在HTML解析过程中遇见js标签，会<strong>停止解析html，加载和执行js代码。</strong></p> <p>js代码则是由***Js引擎***来执行</p> <h3 id="v8引擎架构"><a href="#v8引擎架构" class="header-anchor">#</a> V8引擎架构</h3> <p><img src="https://gitee.com/coderPjx/images/raw/master/images/Snipaste_2021-11-14_14-17-16.jpg" alt=""></p> <ul><li><p>parser</p> <ol><li><p>词法分析：将代码字符串分解为<strong>词法单元tokens</strong></p></li> <li><p>语法分析：将词法单元流（数组）转换成一个有元素逐级嵌套组成的语法结构树，<strong>AST抽象语法树</strong></p> <p>AST抽象语法树在线工具：https://astexplorer.net/</p></li></ol></li> <li><p>ignition</p> <ol><li>解释器，将AST抽象语法树转换成bytecode字节码</li> <li>手机TurboFan优化所需要的信息（如函数参数类型，有了参数类型才能进行真是运算）</li></ol></li> <li><p>turboFan</p> <ol><li>编译器，可以将字节码编译为CPU可以直接执行的机器码</li> <li>如果一个函数被多次调用，会被标记为<strong>热点函数</strong>，会被turboFan转换成优化的机器码</li> <li>但是如果在函数执行过程中，函数参数类型变化，经过优化的机器码会逆向转化为没有优化的字节码</li></ol></li></ul> <h3 id="v8引擎解析图"><a href="#v8引擎解析图" class="header-anchor">#</a> V8引擎解析图</h3> <p><img src="https://gitee.com/coderPjx/images/raw/master/images/Snipaste_2021-11-14_14-43-07.jpg" alt=""></p> <p>js代码解析过程</p> <ol><li><p>浏览器内核Blink将源码交给V8引擎</p></li> <li><p>Stream获取到源码并进行编码转换</p></li> <li><p>Scanner扫描器进行词法分析，分解词法单元tokens</p></li> <li><p>Parser和PreParser将tokens转成AST抽象语法树</p> <ul><li><p>PreParser是预解析，V8引擎实现了Lazy Parsing(延迟解析)，将不必要的代码进行<strong>预解析</strong>，只解析必要的代码，在函数被调用时进行函数<strong>全量解析</strong></p> <div class="language- extra-class"><pre class="language-text"><code>function outer() {
	// 只会预解析inner函数
	function inner(){
	
	}
	inner()
}
// 调用时只解析outer函数，预解析inner函数
outer()
</code></pre></div></li></ul></li> <li><p>AST数经过ignition解释器转换成字节码执行</p></li></ol> <h3 id="js代码执行原理"><a href="#js代码执行原理" class="header-anchor">#</a> JS代码执行原理</h3> <ol><li><p>代码执行前，JS引擎创建一个全局对象（Global Object GO）</p> <ul><li>所有作用域都可以访问GO</li> <li>GO中包含全局的类、方法和属性
<ul><li>Data类、Array类、String类、Number类。。。</li> <li>setTimeout、setInterval方法。。。</li> <li>window属性，指向GO本身</li></ul></li></ul></li> <li><p>JS引擎内部执行上下文栈(Execution Context Stack,ESC)，执行全局代码块</p> <p>为了执行全局代码会创建全局执行上下文Global Execution Context(GEC)，GEC会被放入ESC</p> <ul><li><p>ESC</p> <ul><li><p>GEC</p> <ol><li><p>GO初始化，将全局定义变量和函数加入到GO，但是不赋值</p> <p><strong>这个过程也叫做变量作用域提升（提升至全局作用域）</strong></p></li> <li><p>执行代码，对变量赋值和执行函数</p></li></ol></li></ul></li></ul></li></ol> <p><img src="https://gitee.com/coderPjx/images/raw/master/images/Snipaste_2021-11-14_16-36-50.jpg" alt=""></p> <h3 id="js执行函数原理"><a href="#js执行函数原理" class="header-anchor">#</a> JS执行函数原理</h3> <p>在JS执行过程中，执行到函数时，会根据函数体创建一个函数执行上下文（Function Excution Context,<strong>FEC</strong>）,并压入EC Stack</p> <p>FEC包含三部分：</p> <ul><li><p>AO对象 ：形参、Arguments、嵌套函数定义和指向函数对象、定义的变量</p></li> <li><p>作用域链：由VO对象（函数中就是AO）和父级作用域的VO组成，查找变量时沿着作用域链向父级作用域查找。</p> <p><strong>函数的父级作用域在函数定义的时候就确定了</strong></p></li> <li><p>this绑定的值</p></li></ul> <p><img src="https://gitee.com/coderPjx/images/raw/master/images/Snipaste_2021-11-20_16-36-40.jpg" alt=""></p> <h3 id="js内存管理"><a href="#js内存管理" class="header-anchor">#</a> JS内存管理</h3> <p>内存管理三步：</p> <ol><li>申请所需内存</li> <li>分配内存</li> <li>释放内存</li></ol> <p>常见垃圾回收算法（GC算法）</p> <ul><li><p><strong>引用计数</strong></p> <ul><li>当一个对象有一个引用指向它时，那么这个对象的引用就+1，当一个对象的引用为0时，这个对象就可以被销毁掉</li> <li>弊端：会产生循环引用</li></ul> <p><img src="https://gitee.com/coderPjx/images/raw/master/images/Snipaste_2021-11-21_14-12-58.jpg" alt=""></p></li> <li><p><strong>标记清除</strong></p> <ul><li>这个算法是设置一个根对象（root object），垃圾回收器会定期从这个根开始，找所有从根开始有引用到的对象，对于没有引用到的对象，就认为是不可用的对象</li> <li>解决了循环引用问题</li></ul> <p><img src="https://gitee.com/coderPjx/images/raw/master/images/Snipaste_2021-11-21_14-13-11.jpg" alt=""></p></li></ul> <h3 id="闭包"><a href="#闭包" class="header-anchor">#</a> 闭包</h3> <p>在JS中，函数是<strong>一等公民</strong>。</p> <p>这意味着，函数可以作为另外一个函数的参数，也可以作为另外一个函数的返回值来使用。</p> <p>Wiki百科定义：</p> <ul><li>闭包（Closure），又称词法闭包(lexical Closure)或函数闭包(function closure)</li> <li>是在支持<strong>头等函数</strong>（函数是第一公民）的编程语言中，实现词法绑定的一种技术</li> <li>闭包在实现上是一个结构体，<strong>存储了一个函数和一个关联的环境</strong></li> <li>闭包和函数的最大区别在于，当捕捉闭包的时候，它的自由变量会在捕捉的时候被确定。这样及时脱离了捕捉时的上下文，也能照常执行</li></ul> <p>MDN定义：</p> <ul><li>一个函数和对其周围状态（lexical enviroment,词法环境）的引用捆绑在一起（或者说函数被引用包围），这样的组合就是闭包</li> <li>也就是说，<strong>闭包让你可以在一个内层函数中访问到其外层函数的作用域</strong></li> <li>在Js中，<strong>每当创建一个函数，闭包就会在函数创建的同时被创建出来</strong></li></ul> <p><strong>总结：</strong></p> <ol><li>如果一个函数可以访问外层作用域的自由变量，这个函数就是闭包</li> <li>广义：js中函数都是闭包</li> <li>狭义：js中函数如果访问了外层作用域的变量，就是闭包</li></ol> <h3 id="闭包内存泄漏"><a href="#闭包内存泄漏" class="header-anchor">#</a> 闭包内存泄漏</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span>
    <span class="token comment">// bar函数是闭包</span>
    <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 引用外层作用域的自由变量name</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> bar
<span class="token punctuation">}</span>
<span class="token comment">// 外层作用域的函数foo执行完，AO对象由于被bar函数引用，不会被立刻销毁</span>
<span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>当闭包引用了外层作用域中的自由变量，外层作用域中的AO对象由于被引用了，所以即使外层作用域的函数已经执行完了，<strong>AO对象也不会被释放掉</strong>。最终会造成内存泄漏。</p> <p>解决内存泄漏：</p> <p><strong>将函数指向null，即空内存地址</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fn <span class="token operator">=</span> <span class="token keyword">null</span>
foo <span class="token operator">=</span> <span class="token keyword">null</span>
</code></pre></div><h2 id="js函数"><a href="#js函数" class="header-anchor">#</a> JS函数</h2> <h3 id="this指向"><a href="#this指向" class="header-anchor">#</a> this指向</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 定义一个函数</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 1.直接调用</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// window</span>

<span class="token comment">// 2.对象调用</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;pjx&quot;</span>，
    <span class="token literal-property property">foo</span><span class="token operator">:</span>foo
<span class="token punctuation">}</span>

obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// obj对象</span>

<span class="token comment">// 3.call/apply调用</span>
<span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span> <span class="token comment">// String {&quot;abc&quot;}对象</span>
</code></pre></div><p>上面的案例可以看出：</p> <ol><li>函数调用时，js会默认给this绑定值</li> <li>this的绑定和函数定义的位置 <strong>没有关系</strong></li> <li>this的绑定和函数的调用方式和调用位置 <strong>有关系</strong></li> <li>this是在运行时被绑定的</li></ol> <h3 id="四种绑定规则"><a href="#四种绑定规则" class="header-anchor">#</a> 四种绑定规则</h3> <ol><li><strong>默认绑定</strong></li></ol> <p>当函数独立调用时</p> <ul><li><p>浏览器环境</p> <p>this指向 window对象</p></li> <li><p>Node环境</p> <p>this指向 {} 空对象</p></li></ul> <ol start="2"><li><strong>隐式绑定</strong></li></ol> <p>通过某个对象进行调用</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  	<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;why&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">foo</span><span class="token operator">:</span> foo
<span class="token punctuation">}</span>

obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// obj对象</span>
</code></pre></div><ol start="3"><li><strong>显式绑定</strong></li></ol> <p>通过apply、call、bind进行调用</p> <p>this指向传入的参数</p> <ol start="4"><li><strong>new绑定</strong></li></ol> <p>this指向new 关键字创建的对象</p> <p>使用<strong>new关键字</strong>调用函数时，会执行如下操作：</p> <ol><li>创建一个全新对象</li> <li>新对象会被执行protoType连接</li> <li>新对象会绑定到函数调用的this上（this绑定在这个步骤完成）</li> <li>如果<strong>函数没有返回其他对象，表达式会返回这个新对象</strong></li></ol> <h3 id="绑定优先级"><a href="#绑定优先级" class="header-anchor">#</a> 绑定优先级</h3> <p>默认绑定 &lt; 隐式绑定 &lt; 显式绑定 &lt; new绑定</p> <h3 id="特殊绑定规则"><a href="#特殊绑定规则" class="header-anchor">#</a> 特殊绑定规则</h3> <ol><li><p>忽略显式绑定</p> <p>显式绑定值为 <code>null</code>或者 <code>undefined</code>时，this为 <code>window</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// window</span>
<span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token comment">// window</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// window</span>
</code></pre></div></li> <li><p>间接函数引用</p> <p><strong>注意：</strong>（ob2.foo = obj1.foo）赋值表达式的结果是foo函数</p> <p>当foo直接被调用，默认绑定window</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;obj1&quot;</span><span class="token punctuation">,</span>
	<span class="token literal-property property">foo</span><span class="token operator">:</span>foo <span class="token comment">//函数</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;obj2&quot;</span>
<span class="token punctuation">}</span>

obj1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 函数</span>
<span class="token punctuation">(</span>obj2<span class="token punctuation">.</span>foo <span class="token operator">=</span> obj1<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用函数 window </span>
</code></pre></div></li> <li><p>ES6箭头函数</p> <p>箭头函数不使用this绑定的四种规则，也就是不绑定this，而是指向外层作用域的this。</p></li></ol> <h3 id="手写call"><a href="#手写call" class="header-anchor">#</a> 手写call</h3> <p>注意：如果原来传入的thisArgs中本身就有fn，可以使用<code>Symbol</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>	<span class="token keyword">const</span> symbol <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    thisArgs<span class="token punctuation">[</span>symbol<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myCall</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">thisArgs<span class="token punctuation">,</span><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    thisArgs <span class="token operator">=</span> <span class="token punctuation">(</span>thisArgs <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> thisArgs <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">Object</span><span class="token punctuation">(</span>thisArgs<span class="token punctuation">)</span> <span class="token operator">:</span> window<span class="token punctuation">;</span>
    thisArgs<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token keyword">this</span> <span class="token comment">// 获取真实调用的函数</span>
    <span class="token keyword">var</span> res <span class="token operator">=</span> thisArgs<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
    <span class="token keyword">delete</span> thisArgs<span class="token punctuation">.</span>fn
    <span class="token keyword">return</span> res
<span class="token punctuation">}</span>
</code></pre></div><h3 id="手写apply"><a href="#手写apply" class="header-anchor">#</a> 手写apply</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myApply</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">thisArgs<span class="token punctuation">,</span>argsArr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    thisArgs <span class="token operator">=</span> <span class="token punctuation">(</span>thisArgs <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> thisArgs <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">Object</span><span class="token punctuation">(</span>thisArgs<span class="token punctuation">)</span> <span class="token operator">:</span> window<span class="token punctuation">;</span>
    thisArgs<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token keyword">this</span> <span class="token comment">// 获取真实调用的函数</span>
    <span class="token keyword">var</span> res
    argsArr <span class="token operator">=</span> argsArr <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    res <span class="token operator">=</span> thisArgs<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>argsArr<span class="token punctuation">)</span>
    <span class="token keyword">delete</span> thisArgs<span class="token punctuation">.</span>fn
    <span class="token keyword">return</span> res
<span class="token punctuation">}</span>
</code></pre></div><h3 id="手写bind"><a href="#手写bind" class="header-anchor">#</a> 手写bind</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myBind</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">thisArgs<span class="token punctuation">,</span><span class="token operator">...</span>bindArgs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
	thisArgs <span class="token operator">=</span> <span class="token punctuation">(</span>thisArgs <span class="token operator">!==</span> <span class="token keyword">null</span>  <span class="token operator">&amp;&amp;</span> thisArgs <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">Object</span><span class="token punctuation">(</span>thisArgs<span class="token punctuation">)</span> <span class="token operator">:</span> window
	thisArgs<span class="token punctuation">.</span>fn <span class="token operator">=</span> fn<span class="token punctuation">;</span>
	<span class="token keyword">function</span> <span class="token function">proxyFn</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>newArgs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> finalArgs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>bindArgs<span class="token punctuation">,</span> <span class="token operator">...</span>newArgs<span class="token punctuation">]</span>
		<span class="token keyword">var</span> res <span class="token operator">=</span> thisArgs<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>finalArgs<span class="token punctuation">)</span>
		<span class="token keyword">delete</span> thisArgs<span class="token punctuation">.</span>fn
		<span class="token keyword">return</span> res
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> proxyFn<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="函数柯里化"><a href="#函数柯里化" class="header-anchor">#</a> 函数柯里化</h3> <p>概念：</p> <p>传递给函数一部分参数来调用它，让它<strong>返回一个函数</strong>去处理剩余的参数；</p> <p>这个过程就称之为柯里化</p> <p>例如:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 普通函数</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c
<span class="token punctuation">}</span>

<span class="token comment">// 柯里化函数</span>
<span class="token keyword">function</span> <span class="token function">curryAdd</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 简化版柯里化函数</span>
<span class="token keyword">var</span> <span class="token function-variable function">curryAdd</span> <span class="token operator">=</span> <span class="token parameter">a</span> <span class="token operator">=&gt;</span> <span class="token parameter">b</span> <span class="token operator">=&gt;</span> <span class="token parameter">c</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c
<span class="token punctuation">}</span>

<span class="token comment">// 调用函数</span>
<span class="token function">curryAdd</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> 
</code></pre></div><h4 id="作用"><a href="#作用" class="header-anchor">#</a> 作用</h4> <ul><li><p>函数<strong>职责单一化</strong>，符合设计模式中的单一职责原则</p> <p>让每一次的函数调用都实现不同的作用</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">curryFn</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    a <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        b <span class="token operator">=</span> b <span class="token operator">*</span> <span class="token number">2</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            c <span class="token operator">=</span> c <span class="token operator">*</span> <span class="token number">10</span>
            <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 调用函数</span>
<span class="token function">curryFn</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>实现函数<strong>逻辑复用</strong>和<strong>函数定制化</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 例子1 固定不变的参数不需要传入(x)</span>
<span class="token keyword">function</span> <span class="token function">makeAdder</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    x <span class="token operator">=</span> x <span class="token operator">*</span> <span class="token number">2</span> 
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> x <span class="token operator">+</span> y
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> double5 <span class="token operator">=</span> <span class="token function">makeAdder</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">// 5 * 2 = 10</span>
<span class="token function">double5</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">// 10 + 10 =20</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 例子2 打印定制化日志</span>

<span class="token comment">// 未定制</span>
<span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token parameter">date<span class="token punctuation">,</span> type<span class="token punctuation">,</span> message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
		<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>date<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>date
			<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] [</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] [</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;DEBUG&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;修复BUG&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 定制化</span>
<span class="token keyword">var</span> <span class="token function-variable function">log</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">date</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
		<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>date<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>date
			<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] [</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] [</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 1.定制当前时间</span>
<span class="token keyword">var</span> logWithDate <span class="token operator">=</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">logWithDate</span><span class="token punctuation">(</span><span class="token string">&quot;DEBUG&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;修复BUG logWithDate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2.定制当前时间和日志类型</span>
<span class="token keyword">var</span> logWithDateType <span class="token operator">=</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;DEBUG&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">logWithDateType</span><span class="token punctuation">(</span><span class="token string">&quot;修复BUG logWithDateType&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3.定制当前时间和日志类型和消息</span>
<span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;DEBUG&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;修复BUG logWithDateTypeMessage&quot;</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h4 id="实现柯里化"><a href="#实现柯里化" class="header-anchor">#</a> 实现柯里化</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c
<span class="token punctuation">}</span>

<span class="token comment">// 传入函数 并转为柯里化函数</span>
<span class="token keyword">function</span> <span class="token function">myCurryFn</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">curried</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果传入参数 达到调用函数要求的参数的数量 直接调用</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> fn<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 没有达到调用函数的要求的参数的数量 继续传入参数 递归调用</span>
            <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">curried</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token operator">...</span>args<span class="token punctuation">,</span><span class="token operator">...</span>args2<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> curried
<span class="token punctuation">}</span>

<span class="token function">myCurryFn</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// add(10)(20)(30) 60</span>
</code></pre></div><h2 id="js面向对象"><a href="#js面向对象" class="header-anchor">#</a> JS面向对象</h2> <h3 id="对象属性描述符"><a href="#对象属性描述符" class="header-anchor">#</a> 对象属性描述符</h3> <p><strong>Object.defineProperty(obj,prop,descriptor)</strong> 方法会直接在一个对象上定义一个新属性，或者修改一个对象的现有属性，并返回此对象。</p> <p>参数1：obj  要定义属性的对象</p> <p>参数2：prop 要定义或修改的属性名称或Symbol</p> <p>参数3： descriptor 要定义或修改的<strong>属性描述符</strong></p> <p>属性描述符：</p> <ul><li>数据属性描述符</li> <li>存取属性描述符</li></ul> <table><thead><tr><th style="text-align:center;"></th> <th style="text-align:center;">configurable</th> <th style="text-align:center;">enumerable</th> <th style="text-align:center;">value</th> <th style="text-align:center;">writable</th> <th style="text-align:center;">get</th> <th style="text-align:center;">set</th></tr></thead> <tbody><tr><td style="text-align:center;">数据描述符</td> <td style="text-align:center;">√</td> <td style="text-align:center;">√</td> <td style="text-align:center;">√</td> <td style="text-align:center;">√</td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">存取描述符</td> <td style="text-align:center;">√</td> <td style="text-align:center;">√</td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;">√</td> <td style="text-align:center;">√</td></tr></tbody></table> <p>configurable：表示属性是否可以通过delete<strong>删除属性</strong></p> <p>enumerable：表示属性是否可以通过for-in或者Object.keys()<strong>返回该属性</strong></p> <p>writable：表示是否可以<strong>修改属性的值</strong></p> <p>value：属性的value值，读取属性时会返回该值，修改属性时，会对其进行修改</p> <p>get：获取属性时会执行的函数。默认为undefined</p> <p>set：设置属性时会执行的函数。默认为undefined</p> <h3 id="对象方法补充"><a href="#对象方法补充" class="header-anchor">#</a> 对象方法补充</h3> <p><strong>获取对象的属性描述符</strong>：</p> <ul><li>getOwnPropertyDescriptor</li> <li>getOwnPropertyDescriptors</li></ul> <p><strong>禁止对象扩展新属性</strong>：</p> <ul><li>preventExtensions</li></ul> <p><strong>密封</strong>对象，不允许配置和删除属性：</p> <ul><li>seal</li></ul> <p>实际是调用<em>preventExtensions</em>，并且将现有属性的<em>configurable:false</em></p> <p><strong>冻结</strong>对象，不允许修改现有属性：</p> <ul><li>freeze</li></ul> <p>实际上是调用<em>seal</em>，并且将现有属性的<em>writable: false</em></p> <h3 id="创建对象的方法"><a href="#创建对象的方法" class="header-anchor">#</a> 创建对象的方法</h3> <ul><li><p>对象字面量创建</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;pjx&quot;</span><span class="token punctuation">,</span>
	<span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">20</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>new  Object创建</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;pjx&quot;</span>
obj<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">20</span>
</code></pre></div></li></ul> <p>**缺点：**创建同样的对象需要编写重复代码</p> <ul><li><p>工厂模式创建</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">objFactory</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span>  <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	obj<span class="token punctuation">.</span>name <span class="token operator">=</span> name
	obj<span class="token punctuation">.</span>age <span class="token operator">=</span> age
	
	obj<span class="token punctuation">.</span><span class="token function-variable function">eating</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;eating...&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">objFactory</span><span class="token punctuation">(</span><span class="token string">&quot;pjx&quot;</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>缺点</strong>：创建的对象类型都是Object类型，这些对象应该有一个他们共同的类型</p></li> <li><p>构造函数创建</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age
    
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">eating</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;eating...&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过构造函数创建的对象，<strong>对象类型为constrctor.name属性</strong>，即类型为Person。</p> <p><strong>缺点：<strong>创建对象时</strong>重复创建函数对象实例</strong></p></li> <li><p>构造函数和原型组合创建</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age
<span class="token punctuation">}</span>

<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">eating</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;eating...&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>**优点：**创建的对象共享函数</p></li></ul> <h3 id="new操作符的作用"><a href="#new操作符的作用" class="header-anchor">#</a> new操作符的作用</h3> <ol><li>创建一个全新的空对象{}</li> <li>这个对象内部的 <strong>_ <em>proto</em> _属性被赋值为该构造函数的prototype属性</strong></li> <li>构造函数内部this指向新对象</li> <li>如果构造函数未返回非空对象，则返回新对象</li></ol> <h3 id="对象原型-proto-和函数原型prototype"><a href="#对象原型-proto-和函数原型prototype" class="header-anchor">#</a> 对象原型 __ proto __和函数原型prototype</h3> <p>JavaScript中 所有对象都有一个特殊的内置属性 __ proto __（隐式原型），所有的函数都有一个prototype属性（显式原型）</p> <p>通过构造函数创建的所有对象的隐式原型 __ proto __都指向构造函数的显式原型prototype</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
p1<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> p2<span class="token punctuation">.</span>__proto__ <span class="token comment">// true</span>
p1<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype  <span class="token comment">// true</span>
</code></pre></div><p>默认情况下原型上都会添加一个属性叫做<strong>constructor</strong>，这个constructor指向当前的函数对象</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	
<span class="token punctuation">}</span>

<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token comment">// [Function: Person]</span>
p1<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>consturctor <span class="token comment">//  [Function: Person]</span>
p1<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>consturctor<span class="token punctuation">.</span>name <span class="token comment">// Person</span>
</code></pre></div><h3 id="继承"><a href="#继承" class="header-anchor">#</a> 继承</h3> <ul><li><p><strong>原型链继承</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 定义父类</span>
<span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;pjx&quot;</span>
<span class="token punctuation">}</span>
 
<span class="token comment">// 父类原型上添加方法</span>
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">running</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;running...&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义子类</span>
<span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sno <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">}</span>

<span class="token comment">// 将父类对象作为子类原型对象</span>
<span class="token class-name">Student</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 子类原型上添加方法</span>
<span class="token class-name">Student</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">studying</span>  <span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;studying&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>缺点：</strong></p> <ol><li>外界看不到p对象上的属性</li> <li>属性会被多个对象共享，如果对象是引用类型，会出现引用被同时修改的问题</li> <li>Person不能传参数</li></ol></li> <li><p><strong>组合继承</strong></p> <p>在子类型构造函数的内部调用父类型构造函数</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>friends</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// this是student实例对象</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token keyword">this</span><span class="token punctuation">.</span>friends <span class="token operator">=</span> friends
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>friends<span class="token punctuation">,</span>sno</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// this是student实例对象</span>
	<span class="token function">Person</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>friends<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sno <span class="token operator">=</span> sno
<span class="token punctuation">}</span>

<span class="token class-name">Student</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype
</code></pre></div><p><strong>缺点：</strong></p> <ol><li><p>会调用两次父类构造函数</p> <ol><li>创建子类原型时</li> <li>子类构造函数内部</li></ol></li> <li><p>所有的子类实例事实上会拥有两份父类的属性</p></li></ol></li> <li><p><strong>原型式继承</strong></p> <p>**<code>Object.create()</code>**方法创建一个新对象，使用现有的对象来提供新创建的对象的__proto__</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;why&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span>
<span class="token punctuation">}</span>
<span class="token comment">// 原型式继承函数1</span>
<span class="token keyword">var</span> info <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>

<span class="token comment">// 原型式继承函数2</span>
<span class="token keyword">function</span> <span class="token function">createObject1</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> newObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span>newObj<span class="token punctuation">,</span> o<span class="token punctuation">)</span>
  <span class="token keyword">return</span> newObj
<span class="token punctuation">}</span>
 
<span class="token comment">// 原型式继承函数3</span>
<span class="token keyword">function</span> <span class="token function">createObject2</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">Fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token class-name">Fn</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> o
  <span class="token keyword">var</span> newObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> newObj
<span class="token punctuation">}</span>

<span class="token comment">// 3种方式效果一样</span>
<span class="token keyword">var</span> info1 <span class="token operator">=</span> <span class="token function">createObject1</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token keyword">var</span> info2 <span class="token operator">=</span> <span class="token function">createObject2</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> info3 <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info1<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info2<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info3<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info1<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info2<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info3<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p><strong>寄生式继承</strong></p> <p>寄生式继承的思路是<strong>结合原型式继承和工厂模式</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> personObj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">running</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot; running&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createStudent</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 原型式继承</span>
  <span class="token keyword">var</span> stu <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>personObj<span class="token punctuation">)</span>
  
  <span class="token comment">// 工厂模式</span>
  stu<span class="token punctuation">.</span>name <span class="token operator">=</span> name
  stu<span class="token punctuation">.</span><span class="token function-variable function">studying</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">&quot; studying~&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> stu
<span class="token punctuation">}</span>

<span class="token keyword">var</span> stuObj <span class="token operator">=</span> <span class="token function">createStudent</span><span class="token punctuation">(</span><span class="token string">&quot;why&quot;</span><span class="token punctuation">)</span>

</code></pre></div></li> <li><p><strong>寄生组合式继承</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">createObject</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">Fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token class-name">Fn</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> o
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">inheritPrototype</span><span class="token punctuation">(</span><span class="token parameter">SubType<span class="token punctuation">,</span> SuperType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">&quot;constructor&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> SubType
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义Person类和方法</span>
<span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> friends</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age
  <span class="token keyword">this</span><span class="token punctuation">.</span>friends <span class="token operator">=</span> friends
<span class="token punctuation">}</span>

<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">running</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;running~&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token comment">// 组合继承</span>
<span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> friends<span class="token punctuation">,</span> sno<span class="token punctuation">,</span> score</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Person</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> friends<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>sno <span class="token operator">=</span> sno
  <span class="token keyword">this</span><span class="token punctuation">.</span>score <span class="token operator">=</span> score
<span class="token punctuation">}</span>

<span class="token comment">// 寄生</span>
<span class="token function">inheritPrototype</span><span class="token punctuation">(</span>Student<span class="token punctuation">,</span> Person<span class="token punctuation">)</span>

<span class="token class-name">Student</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">studying</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;studying~&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">&quot;why&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;kobe&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stu<span class="token punctuation">)</span>
stu<span class="token punctuation">.</span><span class="token function">studying</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
stu<span class="token punctuation">.</span><span class="token function">running</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="es6"><a href="#es6" class="header-anchor">#</a> ES6</h2> <h3 id="class类"><a href="#class类" class="header-anchor">#</a> class类</h3> <p>es6语法经过babel编译转化为es5代码</p> <p>类的基本写法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ES6</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ES5</span>
<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">_defineProperties</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> props<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">var</span> descriptor <span class="token operator">=</span> props<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> descriptor<span class="token punctuation">.</span>enumerable <span class="token operator">=</span> descriptor<span class="token punctuation">.</span>enumerable <span class="token operator">||</span> <span class="token boolean">false</span><span class="token punctuation">;</span> descriptor<span class="token punctuation">.</span>configurable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span> <span class="token keyword">in</span> descriptor<span class="token punctuation">)</span> descriptor<span class="token punctuation">.</span>writable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> descriptor<span class="token punctuation">.</span>key<span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">_createClass</span><span class="token punctuation">(</span><span class="token parameter">Constructor<span class="token punctuation">,</span> protoProps<span class="token punctuation">,</span> staticProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>protoProps<span class="token punctuation">)</span> <span class="token function">_defineProperties</span><span class="token punctuation">(</span><span class="token class-name">Constructor</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> protoProps<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>staticProps<span class="token punctuation">)</span> <span class="token function">_defineProperties</span><span class="token punctuation">(</span>Constructor<span class="token punctuation">,</span> staticProps<span class="token punctuation">)</span><span class="token punctuation">;</span> Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>Constructor<span class="token punctuation">,</span> <span class="token string">&quot;prototype&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> Constructor<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">_classCallCheck</span><span class="token punctuation">(</span><span class="token parameter">instance<span class="token punctuation">,</span> Constructor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>instance <span class="token keyword">instanceof</span> <span class="token class-name">Constructor</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot call a class as a function&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>

<span class="token keyword">var</span> Person <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span><span class="token function">_createClass</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">_classCallCheck</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> Person<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>类的继承：</p> <p>/<em>#<strong>PURE</strong></em>/ 标记：将函数标记为<strong>纯函数</strong>，在打包时有利于做<strong>tree-shaking优化</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ES6</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
	
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
 	 
<span class="token punctuation">}</span>


<span class="token comment">// ES5</span>

<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">_typeof</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token string">&quot;@babel/helpers - typeof&quot;</span><span class="token punctuation">;</span> <span class="token keyword">return</span> _typeof <span class="token operator">=</span> <span class="token string">&quot;function&quot;</span> <span class="token operator">==</span> <span class="token keyword">typeof</span> Symbol <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;symbol&quot;</span> <span class="token operator">==</span> <span class="token keyword">typeof</span> Symbol<span class="token punctuation">.</span>iterator <span class="token operator">?</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">typeof</span> obj<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> obj <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;function&quot;</span> <span class="token operator">==</span> <span class="token keyword">typeof</span> Symbol <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Symbol <span class="token operator">&amp;&amp;</span> obj <span class="token operator">!==</span> <span class="token class-name">Symbol</span><span class="token punctuation">.</span>prototype <span class="token operator">?</span> <span class="token string">&quot;symbol&quot;</span> <span class="token operator">:</span> <span class="token keyword">typeof</span> obj<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function">_typeof</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">_inherits</span><span class="token punctuation">(</span><span class="token parameter">subClass<span class="token punctuation">,</span> superClass</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> superClass <span class="token operator">!==</span> <span class="token string">&quot;function&quot;</span> <span class="token operator">&amp;&amp;</span> superClass <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&quot;Super expression must either be null or a function&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> subClass<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>superClass <span class="token operator">&amp;&amp;</span> superClass<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">constructor</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> subClass<span class="token punctuation">,</span> <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>subClass<span class="token punctuation">,</span> <span class="token string">&quot;prototype&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>superClass<span class="token punctuation">)</span> <span class="token function">_setPrototypeOf</span><span class="token punctuation">(</span>subClass<span class="token punctuation">,</span> superClass<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">_setPrototypeOf</span><span class="token punctuation">(</span><span class="token parameter">o<span class="token punctuation">,</span> p</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> _setPrototypeOf <span class="token operator">=</span> Object<span class="token punctuation">.</span>setPrototypeOf <span class="token operator">||</span> <span class="token keyword">function</span> <span class="token function">_setPrototypeOf</span><span class="token punctuation">(</span><span class="token parameter">o<span class="token punctuation">,</span> p</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> o<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> p<span class="token punctuation">;</span> <span class="token keyword">return</span> o<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token function">_setPrototypeOf</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">_createSuper</span><span class="token punctuation">(</span><span class="token parameter">Derived</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">var</span> hasNativeReflectConstruct <span class="token operator">=</span> <span class="token function">_isNativeReflectConstruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">_createSuperInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">var</span> Super <span class="token operator">=</span> <span class="token function">_getPrototypeOf</span><span class="token punctuation">(</span>Derived<span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>hasNativeReflectConstruct<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">var</span> NewTarget <span class="token operator">=</span> <span class="token function">_getPrototypeOf</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span>constructor<span class="token punctuation">;</span> result <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">(</span>Super<span class="token punctuation">,</span> arguments<span class="token punctuation">,</span> NewTarget<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> result <span class="token operator">=</span> <span class="token function">Super</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">return</span> <span class="token function">_possibleConstructorReturn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">_possibleConstructorReturn</span><span class="token punctuation">(</span><span class="token parameter">self<span class="token punctuation">,</span> call</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>call <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">_typeof</span><span class="token punctuation">(</span>call<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> call <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> call<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>call <span class="token operator">!==</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&quot;Derived constructors may only return object or undefined&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">return</span> <span class="token function">_assertThisInitialized</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">_assertThisInitialized</span><span class="token punctuation">(</span><span class="token parameter">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>self <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceError</span><span class="token punctuation">(</span><span class="token string">&quot;this hasn't been initialised - super() hasn't been called&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">return</span> self<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">_isNativeReflectConstruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Reflect <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span> <span class="token operator">||</span> <span class="token operator">!</span>Reflect<span class="token punctuation">.</span>construct<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Reflect<span class="token punctuation">.</span>construct<span class="token punctuation">.</span>sham<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Proxy <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>Reflect<span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">_getPrototypeOf</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> _getPrototypeOf <span class="token operator">=</span> Object<span class="token punctuation">.</span>setPrototypeOf <span class="token operator">?</span> Object<span class="token punctuation">.</span><span class="token function-variable function">getPrototypeOf</span> <span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">_getPrototypeOf</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> o<span class="token punctuation">.</span>__proto__ <span class="token operator">||</span> Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token function">_getPrototypeOf</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">_defineProperties</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> props<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">var</span> descriptor <span class="token operator">=</span> props<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> descriptor<span class="token punctuation">.</span>enumerable <span class="token operator">=</span> descriptor<span class="token punctuation">.</span>enumerable <span class="token operator">||</span> <span class="token boolean">false</span><span class="token punctuation">;</span> descriptor<span class="token punctuation">.</span>configurable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span> <span class="token keyword">in</span> descriptor<span class="token punctuation">)</span> descriptor<span class="token punctuation">.</span>writable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> descriptor<span class="token punctuation">.</span>key<span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">_createClass</span><span class="token punctuation">(</span><span class="token parameter">Constructor<span class="token punctuation">,</span> protoProps<span class="token punctuation">,</span> staticProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>protoProps<span class="token punctuation">)</span> <span class="token function">_defineProperties</span><span class="token punctuation">(</span><span class="token class-name">Constructor</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> protoProps<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>staticProps<span class="token punctuation">)</span> <span class="token function">_defineProperties</span><span class="token punctuation">(</span>Constructor<span class="token punctuation">,</span> staticProps<span class="token punctuation">)</span><span class="token punctuation">;</span> Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>Constructor<span class="token punctuation">,</span> <span class="token string">&quot;prototype&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> Constructor<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">_classCallCheck</span><span class="token punctuation">(</span><span class="token parameter">instance<span class="token punctuation">,</span> Constructor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>instance <span class="token keyword">instanceof</span> <span class="token class-name">Constructor</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot call a class as a function&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>

<span class="token keyword">var</span> Person <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span><span class="token function">_createClass</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">_classCallCheck</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> Person<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> Student <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_Person</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">_inherits</span><span class="token punctuation">(</span>Student<span class="token punctuation">,</span> _Person<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> _super <span class="token operator">=</span> <span class="token function">_createSuper</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">_classCallCheck</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> Student<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">_super</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token function">_createClass</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="let和const"><a href="#let和const" class="header-anchor">#</a> let和const</h3> <p>相同点：</p> <ol><li><p>存在块级作用域</p></li> <li><p>不能重复声明</p></li> <li><p>不存在变量提升</p></li> <li><p>存在暂时性死区</p> <p><strong>这些变量在包含他们的词法环境被实例化时会被创建，但是不可以访问它们的，直到词法绑定被求值</strong></p></li></ol> <p>不同点：</p> <ol><li><p>let声明的数据可以修改赋值 用于声明基本类型数据</p> <p>const声明的数据赋值后不可以修改，如果是引用类型的数据可以修改属性值，不可以修改引用地址</p></li></ol> <p><strong>声明变量保存位置</strong></p> <p>在全局通过var来声明一个变量，事实上会在<strong>window</strong>上添加一个属性，但是<strong>let、const是不会给window上添加任何属性的</strong></p> <p>先回顾一下最新的ECMA标准中对执行上下文的描述</p> <p><img src="https://gitee.com/coderPjx/images/raw/master/images/Snipaste_2022-03-16_15-51-12.jpg" alt=""></p> <p>也就是说我们<strong>声明的变量和环境记录是被添加到变量环境</strong>中的</p> <p>但是标准没有规定这个对象是window对象或者其他对象。那么JS引擎在解析的时候，其实会有自己的实现；</p> <p>比如v8中其实是通过<strong>VariableMap</strong>的一个hashmap来实现它们的存储的。</p> <p>那么window对象呢？window对象是早期的GO对象，在最新的实现中其实是浏览器添加的全局对象，并且</p> <p>一直<strong>保持了window和var之间值的相等性</strong></p> <h3 id="symbol"><a href="#symbol" class="header-anchor">#</a> Symbol</h3> <p>Symbol是ES6中新增的一个基本数据类型，在ES6之前，对象的属性名都是<strong>字符串形式</strong>，那么很容易造成<strong>属性名的冲突</strong></p> <p>Symbol就是为了解决上面的问题，用来<strong>生成一个独一无二的值</strong>。</p> <p>**Symbol即使多次创建值，它们也是不同的：**Symbol函数执行后每次创建出来的值都是独一无二的；</p> <p>我们也可以在创建Symbol值的时候传入一个描述description：这个是ES2019（ES10）新增的特性；</p> <p><strong>注意点：</strong></p> <ol><li><p>不能通过 <strong>.</strong> 的方式获取对象中的Symbol属性值</p></li> <li><p>使用Symbol作为key的属性名，在遍历/Object.keys等中是获取不到这些Symbol值。</p> <p>需要<strong>Object.getOwnPropertySymbols</strong>来获取所有Symbol的key</p></li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 1.ES6之前, 对象的属性名(key)</span>
<span class="token comment">// var obj = {</span>
<span class="token comment">//   name: &quot;why&quot;,</span>
<span class="token comment">//   friend: { name: &quot;kobe&quot; },</span>
<span class="token comment">//   age: 18</span>
<span class="token comment">// }</span>


<span class="token comment">// obj['newName'] = &quot;james&quot;</span>
<span class="token comment">// console.log(obj)</span>


<span class="token comment">// 2.ES6中Symbol的基本使用</span>
<span class="token keyword">const</span> s1 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> s2 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s1 <span class="token operator">===</span> s2<span class="token punctuation">)</span> <span class="token comment">// true</span>

<span class="token comment">// ES2019(ES10)中, Symbol还有一个描述(description)</span>
<span class="token keyword">const</span> s3 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s3<span class="token punctuation">.</span>description<span class="token punctuation">)</span> <span class="token comment">// aaa</span>


<span class="token comment">// 3.Symbol值作为key</span>
<span class="token comment">// 3.1.在定义对象字面量时使用</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>s1<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>s2<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">&quot;cba&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 3.2.新增属性</span>
obj<span class="token punctuation">[</span>s3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;nba&quot;</span>

<span class="token comment">// 3.3.Object.defineProperty方式</span>
<span class="token keyword">const</span> s4 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> s4<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;mba&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>s1<span class="token punctuation">]</span><span class="token punctuation">,</span> obj<span class="token punctuation">[</span>s2<span class="token punctuation">]</span><span class="token punctuation">,</span> obj<span class="token punctuation">[</span>s3<span class="token punctuation">]</span><span class="token punctuation">,</span> obj<span class="token punctuation">[</span>s4<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// 注意: 不能通过.语法获取</span>
<span class="token comment">// console.log(obj.s1)</span>

<span class="token comment">// 4.使用Symbol作为key的属性名,在遍历/Object.keys等中是获取不到这些Symbol值</span>
<span class="token comment">// 需要Object.getOwnPropertySymbols来获取所有Symbol的key</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertySymbols</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> sKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertySymbols</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> sKey <span class="token keyword">of</span> sKeys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>sKey<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 5.Symbol.for(key)/Symbol.keyFor(symbol)</span>
<span class="token keyword">const</span> sa <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// 指定描述符</span>
<span class="token keyword">const</span> sb <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sa <span class="token operator">===</span> sb<span class="token punctuation">)</span> <span class="token comment">// true</span>

<span class="token keyword">const</span> key <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">keyFor</span><span class="token punctuation">(</span>sa<span class="token punctuation">)</span> <span class="token comment">// 指定Symbol获取对应的key</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token comment">// aaa</span>
<span class="token keyword">const</span> sc <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sa <span class="token operator">===</span> sc<span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div><h3 id="weakset"><a href="#weakset" class="header-anchor">#</a> WeakSet</h3> <p>WeakSet和Set的区别：</p> <ol><li><p>WeakSet<strong>只能存储对象引用</strong>，不能存储值</p></li> <li><p>WeakSet对元素的引用是<strong>弱引用</strong>，如果没有其他的变量或属性引用这个对象值, 则这个对象值会被当成垃圾回收掉. 正因为这样, <code>WeakSet</code> 对象是<strong>无法被枚举</strong>的, 没有办法拿到它包含的所有元素</p> <p><strong>弱引用</strong>：在js中，如果一个对象被引用，不会被GC当成垃圾回收。而弱引用相当于没有引用，如果对象被弱引用，不会屏蔽GC回收。</p></li></ol> <p>WeakSet常见的方法：</p> <ul><li><p>add(value)：添加某个元素，返回WeakSet对象本身；</p></li> <li><p>delete(value)：从WeakSet中删除和这个值相等的元素，返回boolean类型；</p></li> <li><p>has(value)：判断WeakSet中是否存在某个元素，返回boolean类型；</p></li></ul> <p><strong>注意：WeakSet不能通过forEach或者for of 遍历</strong></p> <p>作用：不大</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> requests <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">ApiRequest</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    requests<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">makeRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>request<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid access&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// do work</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="weakmap"><a href="#weakmap" class="header-anchor">#</a> WeakMap</h3> <p>WeakMap和Map的区别</p> <ol><li>WeakMap的<strong>key只能使用对象</strong>，不接受其他的类型作为key</li> <li>WeakMap的key对对象的引用是<strong>弱引用</strong>，如果没有其他引用引用这个对象，那么GC可以回收该对象</li></ol> <p>WeakMap常见的方法有四个：</p> <ul><li><p>set(key, value)：在Map中添加key、value，并且返回整个Map对象；</p></li> <li><p>get(key)：根据key获取Map中的value；</p></li> <li><p>has(key)：判断是否包括某一个key，返回Boolean类型；</p></li> <li><p>delete(key)：根据key删除一个键值对，返回Boolean类型；</p></li></ul> <p><strong>注意：WeakMap不能通过forEach或者for of 遍历</strong></p> <p>WeakMap的作用：</p> <p><code>WeakMap</code> 的主要应用场景是 <strong>额外关联数据的存储</strong>。假如正在处理一个“属于”另一个文件的一个对象，也可能是第三方库，并想存储一些与之相关的数据，那么这些数据就应该与这个对象共存，这时候就 <code>WeakMap</code> 就派上用场。将这些数据放到 <code>WeakMap</code> 中，并使用该对象作为这些数据的键，那么当该对象被垃圾回收机制回收后，这些数据也会垃圾回收机制清除了。</p> <p>比较经典的 WeakMap 应用的场景，也就是<strong>统计来访用户的数量</strong>，用户对象作为键而统计用户访问的次数。好处就是当 user 设置为 null 该用户访问的记录也就自动从<code>WeakMap</code>中清除了</p> <p>WeakMap也被应用于Vue3响应式原理</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;Tom&quot;</span><span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">nameChangeFn1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;name改变&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">nameChangeFn2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;name改变&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 收集obj1 并关联属性值和改变的回调函数</span>
<span class="token keyword">const</span> objMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> weakMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
objMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token punctuation">[</span>nameChangeFn1，nameChangeFn2<span class="token punctuation">]</span><span class="token punctuation">)</span> 
weakMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj1<span class="token punctuation">,</span>objMap<span class="token punctuation">)</span>

<span class="token comment">// 当name变化 遍历调用回调函数</span>
obj1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Mike&quot;</span>
<span class="token keyword">const</span> tragetMap <span class="token operator">=</span> weakMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span> <span class="token comment">// objMap</span>
<span class="token keyword">const</span> fns <span class="token operator">=</span> targetMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span> <span class="token comment">// </span>
fns<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
</code></pre></div><h2 id="es7"><a href="#es7" class="header-anchor">#</a> ES7</h2> <h3 id="数组includes"><a href="#数组includes" class="header-anchor">#</a> 数组includes</h3> <p>与indexOf方法不同的是，includes方法可以<strong>判断数组是否包含 NaN</strong>，indexOf不可以</p> <h3 id="指数运算符"><a href="#指数运算符" class="header-anchor">#</a> 指数运算符</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">**</span> <span class="token number">3</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token comment">// 27</span>
</code></pre></div><h2 id="es8"><a href="#es8" class="header-anchor">#</a> ES8</h2> <h3 id="object-values"><a href="#object-values" class="header-anchor">#</a> Object.values</h3> <p>ES8中提供了 Object.values 来获取所有的value值</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'Tom'</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ['Tom',20]</span>
</code></pre></div><h3 id="object-entries"><a href="#object-entries" class="header-anchor">#</a> Object.entries</h3> <p>通过Object.entries 可以获取到一个数组，数组中会存放可枚举属性的<strong>键值对数组</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'Tom'</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [['name','Tom'],['age',20]]</span>
</code></pre></div><h3 id="string-padding"><a href="#string-padding" class="header-anchor">#</a> String.padding</h3> <p>ES8中增加了 padStart 和 padEnd 方法，分别是对字符串的首尾进行填充的</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">'Hello World'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 'aaaaHello World'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">padEnd</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 'Hello Worldaaaa'</span>
</code></pre></div><h3 id="尾逗号"><a href="#尾逗号" class="header-anchor">#</a> 尾逗号</h3> <p>在ES8中，我们允许在函数定义和调用时多加一个逗号</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b<span class="token punctuation">,</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="object-descriptors"><a href="#object-descriptors" class="header-anchor">#</a> Object.Descriptors</h3> <p>ES8中增加了另一个对对象的操作是 Object.getOwnPropertyDescriptors，可以获取对象的所有<strong>属性描述符</strong></p> <h2 id="es9"><a href="#es9" class="header-anchor">#</a> ES9</h2> <h3 id="async和await"><a href="#async和await" class="header-anchor">#</a> Async和Await</h3> <h3 id="对象展开符"><a href="#对象展开符" class="header-anchor">#</a> 对象展开符</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'Tom'</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span>obj1<span class="token punctuation">,</span><span class="token literal-property property">sex</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span> <span class="token comment">// {name:'Tom',age:20,sex:1}</span>
</code></pre></div><h3 id="promise-finally"><a href="#promise-finally" class="header-anchor">#</a> Promise finally</h3> <h2 id="es10"><a href="#es10" class="header-anchor">#</a> ES10</h2> <h3 id="数组flat"><a href="#数组flat" class="header-anchor">#</a> 数组flat</h3> <p>flat() 方法会按照一个<strong>可指定的深度</strong>递归遍历数组，并将所有元素与遍历到的子数组中的元素合并为一个新数组返回</p> <p>可以用于实现<strong>数组扁平化</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment">// 两层嵌套数组</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [1, 2, 3, 4, 5, 6]</span>

</code></pre></div><h3 id="数组flatmap"><a href="#数组flatmap" class="header-anchor">#</a> 数组flatMap</h3> <p>flatMap() 方法首先使用映射函数映射每个元素，然后将结果压缩成一个新数组。</p> <p><strong>注意</strong></p> <ol><li><p>flatMap是<strong>先进行map操作，再做flat的操作</strong>；</p></li> <li><p>flatMap中的flat相当于<strong>深度为1</strong>；</p></li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Hello World'</span><span class="token punctuation">,</span><span class="token string">'你好'</span><span class="token punctuation">,</span><span class="token string">'Good Morning'</span><span class="token punctuation">]</span>  <span class="token comment">// 两层嵌套数组</span>
arr<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token string">'World'</span><span class="token punctuation">,</span> <span class="token string">'你好'</span><span class="token punctuation">,</span> <span class="token string">'Good'</span><span class="token punctuation">,</span> <span class="token string">'Morning'</span><span class="token punctuation">]</span>
</code></pre></div><h3 id="object-fromentries"><a href="#object-fromentries" class="header-anchor">#</a> Object.fromEntries</h3> <p>通过 Object.entries 将一个<strong>对象==&gt;entries</strong>，那么如果我们有一个entries了，ES10提供了 Object.formEntries来完成<strong>entries==&gt;对象</strong>的转换</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'Tom'</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> entries <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>entries<span class="token punctuation">)</span> <span class="token comment">// [['name','Tom'],['age',20]]</span>

<span class="token keyword">const</span> info <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span>entries<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span> <span class="token comment">// {name: 'Tom', age: 20}</span>
</code></pre></div><p>应用场景：<strong>ulr参数转换为对象</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">&quot;www.baidu.com?name=Tom&amp;age=20&quot;</span>
<span class="token keyword">let</span> search <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span> <span class="token comment">// name=Tom&amp;age=20</span>
<span class="token keyword">const</span> searchParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>search<span class="token punctuation">)</span> <span class="token comment">// entries</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span>searchParams<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="trimstart和trimend"><a href="#trimstart和trimend" class="header-anchor">#</a> trimStart和trimEnd</h3> <p>去除一个字符串首尾的空格，我们可以通过trim方法，如果单独去除前面或者后面呢</p> <p>ES10中给我们提供了trimStart和trimEnd</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&quot;   Hello World   &quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">trimStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// &quot;Hello World   &quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">trimEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// &quot;   Hello World&quot;</span>
</code></pre></div><h3 id="symbol-description"><a href="#symbol-description" class="header-anchor">#</a> Symbol description</h3> <p>在创建Symbol对象时，可以为Symbol对象指定描述符，后续可以通过描述符获取这个Symbol对象</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> s1 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>  <span class="token comment">// 为s1添加描述符a</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Symbol(a)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span>description<span class="token punctuation">)</span> <span class="token comment">// a</span>
</code></pre></div><h3 id="optional-catch-binding"><a href="#optional-catch-binding" class="header-anchor">#</a> Optional catch binding</h3> <h2 id="es11"><a href="#es11" class="header-anchor">#</a> ES11</h2> <h3 id="bigint"><a href="#bigint" class="header-anchor">#</a> BigInt</h3> <p>ES11中，引入了新的数据类型BigInt，用于表示大的整数</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> max <span class="token operator">=</span> Number<span class="token punctuation">.</span><span class="token constant">MAX_SAFE_INTEGER</span> <span class="token comment">// 9007199254740991</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>max <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 9007199254740992 正常</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>max <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 9007199254740992 异常</span>
</code></pre></div><p>BitInt的表示方法是在数值的后面加上n，和其他类型的数字相加需要转换为BigInt类型</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> bigInt <span class="token operator">=</span> <span class="token number">9007199254740991n</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bigInt <span class="token operator">+</span> <span class="token number">10n</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bigInt <span class="token operator">+</span> <span class="token function">BigInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="空值合并操作符"><a href="#空值合并操作符" class="header-anchor">#</a> 空值合并操作符</h3> <p>空值合并操作符 <code>??</code>，只有当值为<strong>undefined或者null时会合并空值，0或者''不会合并</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> foo1 <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">const</span> res1 <span class="token operator">=</span> foo1 <span class="token operator">||</span> <span class="token string">'默认值'</span> <span class="token comment">// 默认值</span>
<span class="token keyword">const</span> res2 <span class="token operator">=</span> foo1 <span class="token operator">??</span> <span class="token string">'默认值'</span> <span class="token comment">// ''</span>

<span class="token keyword">const</span> foo2 <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">const</span> res3 <span class="token operator">=</span> foo2 <span class="token operator">||</span> <span class="token string">'默认值'</span> <span class="token comment">// 默认值</span>
<span class="token keyword">const</span> res4 <span class="token operator">=</span> foo2 <span class="token operator">??</span> <span class="token string">'默认值'</span> <span class="token comment">// ''</span>
</code></pre></div><h3 id="可选链"><a href="#可选链" class="header-anchor">#</a> 可选链</h3> <p>可选链也是ES11中新增一个特性，主要作用是让我们的代码在<strong>进行null和undefined判断时更加清晰和简洁</strong>，如果没有值不会报错，会会<strong>返回undefined</strong>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'Tom'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">friend</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;Jack&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">girlFriend</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;Rose&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>friend<span class="token operator">?.</span>girlFriend<span class="token punctuation">)</span>
</code></pre></div><h3 id="global-this"><a href="#global-this" class="header-anchor">#</a> Global This</h3> <p>在之前全局对象在浏览器环境下值为 <strong>window 对象</strong>，在Node环境下值为 <strong>global 对象</strong>，ES11新增 <strong>globalThis对象</strong>，对获取全局对象进行了统一的规范。</p> <div class="language- extra-class"><pre class="language-text"><code>console.log(gloabalThis) // 浏览器 window对象
console.log(globalThis) // Node global对象
</code></pre></div><h3 id="for-in标准化"><a href="#for-in标准化" class="header-anchor">#</a> for..in标准化</h3> <p>在ES11之前，虽然很多浏览器支持for...in来遍历对象类型，但是并没有被ECMA标准化。 有些浏览器遍历出的值为对象的value</p> <p>在ES11中，对其进行了标准化，for...in是<strong>用于遍历对象的key的</strong>。</p> <h3 id="dynamic-import"><a href="#dynamic-import" class="header-anchor">#</a> Dynamic Import</h3> <h3 id="promise-allsettled"><a href="#promise-allsettled" class="header-anchor">#</a> Promise.allSettled</h3> <h3 id="import-meta"><a href="#import-meta" class="header-anchor">#</a> import meta</h3> <h2 id="es12"><a href="#es12" class="header-anchor">#</a> ES12</h2> <h3 id="finalizationregistry"><a href="#finalizationregistry" class="header-anchor">#</a> FinalizationRegistry</h3> <p>FinalizationRegistry 对象可以让你在<strong>对象被垃圾回收时请求一个回调</strong></p> <p>通过调用register方法，注册任何你想要清理回调的对象，传入该对象和所含的值。</p> <p><strong>注意：</strong></p> <p>对象被赋值为null后，GC<strong>不会立即回收</strong>，而是在经过算法计算后在某个时间回收</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'Tom'</span><span class="token punctuation">}</span>

<span class="token comment">// 清理回调</span>
<span class="token keyword">const</span> registry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FinalizationRegistry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token string">'被回收了'</span><span class="token punctuation">)</span>  <span class="token comment">// obj对象被回收了</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// register方法注册对象</span>
registry<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">'obj对象'</span><span class="token punctuation">)</span>

obj <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// 置空后回收</span>
</code></pre></div><h3 id="weakref"><a href="#weakref" class="header-anchor">#</a> WeakRef</h3> <p>如果我们默认将一个对象赋值给另外一个引用，那么这个引用是一个强引用。</p> <p>如果我们希望是一个<strong>弱引用</strong>的话，可以使用WeakRef。</p> <p><code>deref()</code>实例方法返回当前实例的<strong>WeakRef对象所绑定的target对象</strong>，如果该target对象已被GC回收则返回<code>undefined</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'Tom'</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakRef</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>

<span class="token comment">// 清理回调</span>
<span class="token keyword">const</span> registry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FinalizationRegistry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token string">'被回收了'</span><span class="token punctuation">)</span>  <span class="token comment">// obj对象被回收了</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// register方法注册对象</span>
registry<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>info<span class="token punctuation">,</span><span class="token string">'info对象'</span><span class="token punctuation">)</span>

obj <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// 置空后回收</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span><span class="token function">deref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// undefined  说明弱引用的对象已经被回收</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="逻辑赋值符"><a href="#逻辑赋值符" class="header-anchor">#</a> 逻辑赋值符</h3> <ul><li>||= 逻辑或</li> <li>&amp;&amp;= 逻辑与</li> <li>??= 逻辑空</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">1.</span>逻辑或
<span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
<span class="token comment">// msg = msg || &quot;Hello World&quot;</span>
msg <span class="token operator">||=</span> <span class="token string">&quot;Hello World&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span> <span class="token comment">// &quot;Hello World&quot;</span>

<span class="token number">2.</span>逻辑与
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'why'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">fn</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">123</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// obj = obj &amp;&amp; obj.fn()</span>
obj <span class="token operator">&amp;&amp;=</span> obj<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token operator">+</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 123...</span>

<span class="token number">3.</span>逻辑空
<span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token keyword">null</span>
foo <span class="token operator">??=</span> <span class="token string">&quot;默认值&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span> <span class="token comment">// 默认值</span>
</code></pre></div><h3 id="数字分隔符"><a href="#数字分隔符" class="header-anchor">#</a> 数字分隔符</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">113_324_345</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="string-replaceall"><a href="#string-replaceall" class="header-anchor">#</a> String.replaceAll</h3> <p>替换字符串中所有匹配到的值</p> <h3 id="proxy类"><a href="#proxy类" class="header-anchor">#</a> Proxy类</h3> <p>为什么需要Proxy类：</p> <ol><li><p>Object.defineProperty<strong>设计的初衷，不是为了去监听截止一个对象中所有的属性的,初衷是定义普通的属性</strong>，但是后面我们强行将它变成了数据属性描述符</p></li> <li><p>Object.defineProperty无法实现监听比如<strong>新增属性、删除属性</strong>的操作</p></li> <li><p>如果希望监听一个对象的相关操作，那么我们可以先创建一个<strong>代理对象</strong>（Proxy对象）。之后对该对象的所有操作，都通过代理对象来完成，代理对象可以监听我们对原对象的操作</p></li> <li><p><strong>基于对代理对象的所有操作，将会自动传递到原对象</strong></p></li></ol> <p>基本使用</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'Tom'</span>
<span class="token punctuation">}</span>

<span class="token comment">// 参数：目标代理对象，代理捕获器</span>
<span class="token keyword">const</span> pbjProxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token comment">// handler捕获器函数</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>newValue<span class="token punctuation">,</span>receiver</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> newValue
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>receiver</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>             
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>注：</strong></p> <p>Proxy类的目的在于通过代理对象实现对原对象的操作，不用直接操作原对象。以上代码<strong>实际上还是在操作原对象</strong>，如<code>return target[key]</code>。</p> <p><strong>通过Proxy类配合Reflect对象实现，即解决以上问题。</strong></p> <p><strong>Proxy捕获器方法和参数</strong></p> <ol><li><strong>get</strong> <ul><li>target：目标对象（侦听的对象）</li> <li>property：将被获取的属性key</li> <li>receiver：调用的代理对象</li></ul></li> <li><strong>set</strong> <ul><li>target：目标对象（侦听的对象）</li> <li>property：将被设置的属性key</li> <li>newValue：新属性值</li> <li>receiver：调用的代理对象</li></ul></li> <li><strong>has</strong>  in 操作符的捕捉器</li> <li><strong>deleteProperty</strong>  delete 操作符的捕捉器</li> <li><strong>apply</strong>  用于<strong>监听函数对象的apply执行</strong></li> <li>construct  用于<strong>监听函数对象的构造函数执行</strong></li> <li>getPrototypeOf</li> <li>setPrototypeOf</li> <li>isExtensible</li> <li>preventExtensions</li> <li>getOwnPropertyDescriptor</li> <li>defineProperty</li> <li>ownKeys</li></ol> <h3 id="reflect对象"><a href="#reflect对象" class="header-anchor">#</a> Reflect对象</h3> <p><strong>Reflect对象的作用</strong></p> <ol><li>它主要提供了很多操作JavaScript对象的方法，有点像Object中操作对象的方法。Reflect.getPrototypeOf(target)类似于 Object.getPrototypeOf()</li></ol> <p><strong>主要应用场景</strong></p> <ol><li>配合Proxy类实现对象操作的监听</li></ol> <p><strong>为什么需要Reflect对象？</strong></p> <ol><li>早期ECMA规范中对 <strong>对象本身 操作设计不规范</strong>，将这些API放到了Object上。但是Object作为构造函数，这些操作实际上放到它身上并不合适。所以在ES6中新增了Reflect，让我们这些<strong>操作集中到了Reflect对象</strong>上；如Proxy类配合Reflect对象实现对象的监听，<code>如Proxy类配合Reflect对象实现对象的监听，原对象的操作都集中在对Reflect对象的操作上</code></li></ol> <p>Object和Reflect对象之间的API关系，可以参考MDN文档：https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/Comparing_Reflect_and_Object_methods</p> <p><strong>常用方法</strong>：</p> <p>它和Proxy是一一对应的，也是13个</p> <ol><li><p>get</p> <ul><li>获取对象身上某个属性的值，类似于 target[name]。</li></ul></li> <li><p><strong>set</strong></p> <ul><li><p>将值分配给属性的函数</p></li> <li><p>不同于defineProperty，当对象被<strong>冻结</strong>或者<strong>不可扩展</strong>时set方法失效，<strong>返回一个Boolean，如果更新成功，则返回true</strong></p></li></ul></li> <li><p>has</p> <ul><li>判断一个对象是否存在某个属性，和 in 运算符 的功能完全相同</li></ul></li> <li><p>deleteProperty</p> <ul><li>作为函数的delete操作符，相当于执行 delete target[name]。</li></ul></li> <li><p>apply</p> <ul><li>对一个函数进行调用操作，同时可以传入一个数组作为调用参数。和Function.prototype.apply() 功能类似</li></ul></li> <li><p>construct</p> <ul><li>对构造函数进行 <strong>new 操作</strong>，相当于执行 new target(...args)</li></ul></li> <li><p>getPrototypeOf</p> <ul><li>类似于 Object.getPrototypeOf()</li></ul></li> <li><p>setPrototypeOf</p> <ul><li>设置对象原型的函数. 返回一个 Boolean， 如果更新成功，则返回true</li></ul></li> <li><p>isExtensible</p> <ul><li>类似于 Object.isExtensible()</li></ul></li> <li><p>preventExtensions</p> <ul><li>类似于 Object.preventExtensions()。返回一个Boolean</li></ul></li> <li><p>getOwnPropertyDescriptor</p> <ul><li>类似于 Object.getOwnPropertyDescriptor()。如果对象中存在该属性，则返回对应的属性描述符, 否则返回 undefined.</li></ul></li> <li><p>defineProperty</p> <ul><li>和 Object.defineProperty() 类似。如果设置成功就会返回 true</li></ul></li> <li><p>ownKeys</p> <ul><li>返回一个包含所有自身属性（不包含继承属性）的数组。(类似于Object.keys(), 但不会受enumerable影响).</li></ul></li></ol> <p>基本使用</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 将Proxy对象对原对象的代理通过Reflect实现</span>
<span class="token keyword">const</span> objProxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token punctuation">{</span>
	<span class="token function-variable function">has</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 当对象被冻结或者不可扩展时set方法失效</span>
    <span class="token comment">// 返回一个Boolean，如果更新成功，则返回true</span>
	<span class="token function-variable function">set</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token function-variable function">get</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token function-variable function">deleteProperty</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">deleteProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>Receiver参数的作用</strong></p> <p>如果我们的源对象（obj）有setter、getter的访问器属性，那么可以通过receiver来<strong>改变里面的this</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">firstname</span><span class="token operator">:</span><span class="token string">'张'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">lastname</span><span class="token operator">:</span><span class="token string">'三'</span>
    <span class="token comment">//getter</span>
	<span class="token keyword">get</span> <span class="token function">fullname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstname <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastname
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">firstname</span><span class="token operator">:</span><span class="token string">'李'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">lastname</span><span class="token operator">:</span><span class="token string">'四'</span>
    <span class="token comment">//getter</span>
	<span class="token keyword">get</span> <span class="token function">fullname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstname <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastname
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>fullname<span class="token punctuation">)</span> <span class="token comment">// 张三</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span><span class="token string">'fullname'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 张三</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span><span class="token string">'fullname'</span><span class="token punctuation">,</span>p2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 李四</span>
</code></pre></div><p><strong>Reflect的construct</strong></p> <p>可以创建一个指定类型的实例对象，这个实例对象的原型对象为其他类型</p> <p><img src="https://gitee.com/coderPjx/images/raw/master/images/Snipaste_2022-04-10_23-24-56.jpg" alt=""></p> <p>应用场景：ES6转Es5的继承实现</p> <h2 id="vue响应式原理"><a href="#vue响应式原理" class="header-anchor">#</a> Vue响应式原理</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">b</span><span class="token operator">:</span><span class="token number">2</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义WeakMap存储依赖 obj -&gt; obj的key -&gt; 依赖key的functions</span>
<span class="token comment">// weakMap允许键为对象，weakMap在key为对象时不会影响垃圾回收，从而影响性能问题</span>
<span class="token keyword">const</span> observers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

observers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 访问对象属性时currentObserver不为null则添加依赖</span>
<span class="token keyword">let</span> currentObserver <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">observe</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  currentObserver <span class="token operator">=</span> fn<span class="token punctuation">;</span>
  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  currentObserver <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">// Proxy代理普通对象并拦截get set方法</span>
<span class="token keyword">let</span> reactiveObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">访问了</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>target<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">的属性</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,值为</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>currentObserver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> targetObserver <span class="token operator">=</span> observers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
      <span class="token comment">// 如果当前属性已经有其他依赖函数,则追加到依赖中</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>targetObserver<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				targetObserver<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>currentObserver<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token comment">// 如果当前属性没有其他依赖函数,则新增到依赖中</span>
				targetObserver<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>currentObserver<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
    <span class="token punctuation">}</span> 
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value<span class="token punctuation">,</span>receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> observersForKey <span class="token operator">=</span> observers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">修改了</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>target<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">的属性</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,值为</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 先修改才能在遍历调用依赖函数时，访问到最新的值</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
    observersForKey<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reactiveObj<span class="token punctuation">.</span>a <span class="token operator">+</span> reactiveObj<span class="token punctuation">.</span>b<span class="token punctuation">)</span>
<span class="token punctuation">}</span>



<span class="token comment">// 调用observe方法 并在get拦截器中添加依赖</span>
<span class="token function">observe</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 测试修改代理对象的属性时，自动调用sum 实现响应式</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  reactiveObj<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  reactiveObj<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="模块化"><a href="#模块化" class="header-anchor">#</a> 模块化</h2> <p><strong>commonJS</strong></p> <p>核心变量：</p> <p>exports、module.exports、require</p> <p>module.exports和exports的关系:</p> <p>module对象的exports属性是exports对象的一个引用</p> <p>缺点：</p> <ul><li>同步加载。意味着只有等到对应的模块加载完毕，当前模块中的内容才能被运行</li></ul> <p>模块加载过程</p> <ul><li>模块在被<em>第一次</em>引入时，模块中的js代码会被运行一次</li> <li>模块被多次引入时，会<strong>缓存</strong>，最终只加载（运行）一次
<ul><li>每个模块对象module都有一个属性：loaded，false表示还没加载，true表示已加载</li></ul></li> <li>如果有循环引入，那么加载顺序是深度优先
<ul><li>模块的引用关系为<strong>图结构</strong>，有深度优先搜索（DFS, depth first search）和广度优先搜索（BFS, breadth first search）；</li> <li>Node采用的是<strong>深度优先</strong>算法</li></ul></li></ul> <p><strong>ADM规范</strong></p> <p>AMD主要是应用于浏览器的一种模块化规范，采用的是异步加载模块。</p> <p>AMD实现的比较常用的库是<em>require.js</em>和<em>curl.js</em></p> <p><strong>CMD规范</strong></p> <p>CMD规范也是应用于浏览器的一种模块化规范，采用了异步加载模块，但是它将CommonJS的优点吸收了过来。</p> <p>CMD也有自己比较优秀的实现方案： <em>SeaJs</em></p> <p><strong>ES Module</strong></p> <ul><li><p>使用<code>import</code>和<code>export</code>关键字</p></li> <li><p>采用编译期的<strong>静态分析</strong>，并且也加入了<strong>动态引用</strong>的方式</p></li> <li><p>自动采用<strong>严格模式</strong>：use strict</p></li></ul> <p>使用注意事项：</p> <ol><li><p>在<code>script</code>标签中引用es module规范的文件时，script标签默认<code>type=&quot;text/javascript&quot;</code>，需要改为<code>type=&quot;module&quot;</code>，通过模块的方式引用。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 报错</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;main.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;main.js&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;module&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div></li> <li><p>当通过本地加载Html 文件并引用es module规范文件，(比如一个 file:// 路径的html文件), 你将会遇到 CORS 错误，因为Javascript 模块安全性需要。</p> <p>可以安装vscode插件<code>live server</code></p></li></ol> <h3 id="cookie"><a href="#cookie" class="header-anchor">#</a> cookie</h3> <p>httpOnly：</p> <p>为true时，只能通过http请求操作cookie，禁止通过客户端进行操作。可以用于处理<strong>XSS攻击</strong>（跨站脚本攻击）</p> <p>缺点：</p> <ol><li><p>浏览器会自动将服务器返回的cookie<strong>自动附加</strong>在每一次的http请求中，即使不需要时会浪费一定的流量</p></li> <li><p>cookie<strong>明文传输</strong>，存在一定安全风险</p></li> <li><p>存在大小限制<strong>4kb</strong>（一般够用）</p></li> <li><p>cookie在客户端验证登录麻烦（客户端除浏览器还包括ios,安卓，小程序等），有时需要手动在请求中添加cookie。</p> <p>取而代之的是<strong>token验证</strong>，采用对称/非对称加密算法，在请求头或请求体中携带传输。</p></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5ab2ec69.js" defer></script><script src="/assets/js/2.eeb24f79.js" defer></script><script src="/assets/js/8.8df23d51.js" defer></script>
  </body>
</html>
